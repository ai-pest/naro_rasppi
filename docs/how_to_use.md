# 診断装置の使い方

ここでは、**診断装置を起動・終了する方法**と、**スマートフォンからアプリを開いて病虫害を診断する方法**を説明します。

## 装置の起動と終了

### 装置の電源を入れるには

1. 装置（Raspberry Pi）裏面のカードスロットに、microSD カードを装着します。  
![装置裏面の microSD カードスロットの位置](./asset/howto_rasppi_microsd.png)
1. 電源ポートに、電源プラグを差し込みます。  
  ※ 電源ポートは、装置の側面にあります。形状は USB Type-C です。  
![装置表面の 電源ポートの位置](./asset/howto_rasppi_power.png)
1. 電源ランプ（基板上の赤いランプ）が点灯し、装置が起動します。  
![装置表面の、電源ランプおよび処理中ランプの位置](./asset/howto_rasppi_leds.png)
1. 1分ほど待つと、Wi-Fi 接続ができる状態になります。

### 装置の電源を切るには

診断中に電源を切ると、microSDカード上のデータが壊れる可能性があります。診断を行っていないことを確認してから、電源を切ってください。

1. 装置に接続しているスマートフォン上で、診断が行われていないことを確認します。
1. 処理中ランプ（基板上の、緑のランプ）が消灯していることを確認します。

    > ⚠️注意⚠️
    > 
    > 緑のランプが点滅しているときに装置の電源を切ると、microSDカード上のデータが壊れ、
    > **装置が正しく動作しなくなる**場合があります。
    > 
    > 万が一、装置が動作しなくなったら、[ブート用イメージの書き込み](./burn_bootable_image.md) で示した手順に沿って
    > microSD カードにデータを書き込み直してください。

1. 電源プラグを抜きます。
1. 装置の電源が切れて、電源ランプが消灯します。

## スマートフォンから病虫害診断する

### 事前準備: 装置に Wi-Fi 接続する

病虫害診断をする前に、スマートフォンから識別装置に Wi-Fi（無線LAN）接続する必要があります。

> ⚠️注意⚠️
>
> * お使いの端末によっては、ここで示した Wi-Fi の設定手順が当てはまらない場合があります。
> * 識別装置に接続しているあいだは、スマートフォンからインターネットへの接続ができません。  
> Wi-Fi 接続を解除すると、再度インターネットに接続できるようになります。  
> （装置に接続したまま、インターネットに接続することはできません。）

> ️📘ノート
>
> * PC からも、装置に Wi-Fi 接続して診断することができます。

#### Android の場合

1. 「設定」アプリ（⚙アイコン）を開きます。  
![ホーム画面から「設定」アプリを選択する](./asset/howto_home_setting.png)
1. 「ネットワークとインターネット」を開きます。  
![設定画面から「ネットワークとインターネット」を選択する](./asset/howto_settings_network.png)
1. 「インターネット」を開きます。  
![設定画面から「ネットワークとインターネット」を選択する](./asset/howto_network_internet.png)
1. 「Wi-Fi」のスイッチがOFFになっているときは、ONにします。  
![「インターネット」画面で、「Wi-Fi」のトグルをオンにする](./asset/howto_internet_wifi.png)
1. 一覧から「`diagnosis_ai`」という名前の項目を選択します。  
![「インターネット」画面で、SSIDが「diagnosis_ai」の項目を選択する](./asset/howto_internet_ssid.png)
1. はじめて接続するときは、パスワードを入力する必要があります。
別途指定されたパスワードを入力します。  
![パスワード入力画面で、パスワードを入力する](./asset/howto_wifi_password.png)
1. 「デバイスに接続されました。」と表示されます。  
![「インターネット」画面で、SSIDが「diagnosis_ai」の項目の下に「デバイスに接続されました。」と表示される](./asset/howto_internet_connected.png)

#### iPhone の場合

1. 「設定」アプリ（⚙アイコン）を開きます。
1. 「Wi-Fi」を開きます。
1. 一覧から「`diagnosis_ai`」という名前の項目を選択します。
1. はじめて接続するときは、パスワードを入力する必要があります。
別途指定されたパスワードを入力します。

設定後、「インターネットに接続されていない」というメッセージが表示されることがありますが、
診断には影響しないので、無視してかまいません。

![「このネットワークはインターネットに接続していません。接続を維持しますか？」というメッセージが表示される。「はい」を押して無視する。](./asset/howto_wifi_no_internet.png)

### 診断アプリを使う（簡易版）

診断アプリを使う方法を説明します。

1. ホーム画面から、Google Chrome や Safari などのブラウザアプリを起動します。  
![ホーム画面からブラウザを選択して起動する。](./asset/howto_home_chrome.png)
1. アドレスバーに下記を入力して、キーボードの確定キーを押します。  
`http://ai.local`  
![アドレスバーにURLを入力し、キーボードの確定キーを押す。](./asset/howto_chrome_webui_url.png)

    > ️📘ノート
    >
    > * `http://` も省略せず入力してください。  
    >   （一部のブラウザでは、`http://` を入力しないと正しいアドレスとして認識されません）
    > * `192.168.10.1` を入力してアプリを開くこともできます。

1. 診断アプリが開きます。  
![診断アプリの初期表示画面。](./asset/howto_webui_init.png)
1. 作物・部位・病虫害の種別・画像を選択します。  
![診断アプリで、作物・部位・病虫害の種別・画像を選択した画面。](./asset/howto_webui_fill_form.png)
1. 「アップロード」ボタンを押すと、診断がはじまります。  
![診断結果の表示画面。結果を示す表に、画像、推測した病虫害名、確信度が表示される。](./asset/howto_webui_upload.png)
1. 5～10秒ほどで、診断結果が表示されます。  
![診断結果の表示画面。結果を示す表に、画像、推測した病虫害名、確信度が表示される。](./asset/howto_webui_result.png)


### 診断アプリを使う（高機能版）

1. ホーム画面から、Google Chrome や Safari などのブラウザアプリを起動します。  
![ホーム画面からブラウザを選択して起動する。](./asset/howto_home_chrome.png)
1. アドレスバーに下記を入力して、キーボードの確定キーを押します。  
`http://ai.local:8080`  
![アドレスバーにURLを入力し、キーボードの確定キーを押す。](./asset/howto_chrome_xplat_url.png)

    > ️📘ノート
    >
    > * `http://` も省略せず入力してください。  
    >   （一部のブラウザでは、`http://` を入力しないと正しいアドレスとして認識されません）
    > * `192.168.10.1:8080` を入力してアプリを開くこともできます。

1. 診断アプリが開きます。  
![アドレスバーにURLを入力し、キーボードの確定キーを押す。](./asset/howto_xplat_menu.png)
1. 画面の指示にしたがって、病虫害の種別・作物・部位を選択し、診断します。  
![アドレスバーにURLを入力し、キーボードの確定キーを押す。](./asset/howto_xplat_process.png)
1. 診断結果が表示されます。  
![アドレスバーにURLを入力し、キーボードの確定キーを押す。](./asset/howto_xplat_result.png)
